<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ _("Farm Shop") }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-50 text-gray-800">

  <nav class="bg-green-700 text-white p-4 flex justify-between items-center shadow">
    <!-- Language selector -->
    <div class="relative inline-block text-left">
      <button id="langButton"
              class="inline-flex justify-center items-center px-3 py-2 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium hover:bg-gray-100 focus:outline-none">
        ğŸŒ {{ _("Language") }}:
        {% if get_locale() == 'pt' %}
          ğŸ‡µğŸ‡¹ PortuguÃªs
        {% else %}
          ğŸ‡¬ğŸ‡§ English
        {% endif %}
      </button>
      <div id="langMenu"
           class="hidden absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-lg shadow-lg z-10">
        <a href="{{ url_for('set_language', lang='en') }}"
           class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ğŸ‡¬ğŸ‡§ English</a>
        <a href="{{ url_for('set_language', lang='pt') }}"
           class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ğŸ‡µğŸ‡¹ PortuguÃªs</a>
      </div>
    </div>

    <a href="{{ url_for('index') }}" class="text-xl font-bold">{{ _("ğŸŒ¾ Farm Shop") }}</a>

    <div class="space-x-4">
      {% if session.get("logged_in") %}
        <a href="{{ url_for('admin_panel') }}" class="hover:underline">{{ _("Admin") }}</a>
        <a href="{{ url_for('logout') }}" class="hover:underline">{{ _("Logout") }}</a>
      {% else %}
        <a href="{{ url_for('login') }}" class="hover:underline">{{ _("Login") }}</a>
      {% endif %}
    </div>
  </nav>

  <main class="container mx-auto p-6">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="mb-4">
          {% for msg in messages %}
            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 rounded mb-2">
              {{ msg }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <footer class="text-center text-sm text-gray-500 py-4 border-t mt-8">
    &copy; {{ current_year|default(2025) }} {{ _("Farm Shop") }}. {{ _("All rights reserved.") }}
  </footer>

  <script nonce="{{ csp_nonce() }}">
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("langButton");
    const menu = document.getElementById("langMenu");

    if (btn && menu) {
      btn.addEventListener("click", () => {
        menu.classList.toggle("hidden");
      });

      document.addEventListener("click", (e) => {
        if (!btn.contains(e.target) && !menu.contains(e.target)) {
          menu.classList.add("hidden");
        }
      });
    }
  });
  </script>
</body>
</html>
